<!DOCTYPE html><html lang="zh-TW" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>資料結構 進階實作（C++） | 4yu Blog</title><meta name="author" content="ShiYu Huang"><meta name="copyright" content="ShiYu Huang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="本篇文章仍在撰寫中 請稍等內容完整後再閱讀… 🔗  本篇文章連結：https:&#x2F;&#x2F;4yu.dev&#x2F;post&#x2F;Data-Structures&#x2F;  Intro 🔗 此篇文章使用 C++ 來實作各種從基礎到進階的資料結構 可先閱讀這篇關於 C++ 內建基礎資料結構的 C++ STL 大全 後再回來繼續 STL 中的基礎資料結構只需學會如何應用即可，而此篇的資料結構則是要自行實作 內容一樣很多，若有編">
<meta property="og:type" content="article">
<meta property="og:title" content="資料結構 進階實作（C++）">
<meta property="og:url" content="https://4yu.dev/post/Data-Structures/index.html">
<meta property="og:site_name" content="4yu Blog">
<meta property="og:description" content="本篇文章仍在撰寫中 請稍等內容完整後再閱讀… 🔗  本篇文章連結：https:&#x2F;&#x2F;4yu.dev&#x2F;post&#x2F;Data-Structures&#x2F;  Intro 🔗 此篇文章使用 C++ 來實作各種從基礎到進階的資料結構 可先閱讀這篇關於 C++ 內建基礎資料結構的 C++ STL 大全 後再回來繼續 STL 中的基礎資料結構只需學會如何應用即可，而此篇的資料結構則是要自行實作 內容一樣很多，若有編">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://4yu.dev/img/data_structure_advan.webp">
<meta property="article:published_time" content="2024-02-29T16:00:00.000Z">
<meta property="article:modified_time" content="2026-02-11T21:19:49.636Z">
<meta property="article:author" content="ShiYu Huang">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="資料結構 Data Structures">
<meta property="article:tag" content="前綴和 &amp; 差分數列">
<meta property="article:tag" content="樹狀數組 BIT">
<meta property="article:tag" content="稀疏表 Sparse Table">
<meta property="article:tag" content="線段樹 Segment Tree">
<meta property="article:tag" content="鏈結串列 Linked-list">
<meta property="article:tag" content="並查集 DSU">
<meta property="article:tag" content="二元搜尋樹 BST">
<meta property="article:tag" content="樹堆 Treap">
<meta property="article:tag" content="伸展樹 Splay Tree">
<meta property="article:tag" content="動態樹 Link-Cut Tree">
<meta property="article:tag" content="字典樹 Trie">
<meta property="article:tag" content="rope">
<meta property="article:tag" content="pbds">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://4yu.dev/img/data_structure_advan.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "資料結構 進階實作（C++）",
  "url": "https://4yu.dev/post/Data-Structures/",
  "image": "https://4yu.dev/img/data_structure_advan.webp",
  "datePublished": "2024-02-29T16:00:00.000Z",
  "dateModified": "2026-02-11T21:19:49.636Z",
  "author": [
    {
      "@type": "Person",
      "name": "ShiYu Huang",
      "url": "https://4yu.dev/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/4yublog.png"><link rel="canonical" href="https://4yu.dev/post/Data-Structures/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=6506400853"></script><script>window.dataLayer = window.dataLayer || []
function gtag(){dataLayer.push(arguments)}
gtag('js', new Date())
gtag('config', '6506400853')
btf.addGlobalFn('pjaxComplete', () => {
  gtag('config', '6506400853', {'page_path': window.location.pathname})
}, 'google_analytics')
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '複製成功',
    error: '複製失敗',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: ShiYu Huang","link":"連結: ","source":"來源: 4yu Blog","info":"著作權歸作者所有。如需商業轉載，請聯絡作者獲得授權，非商業轉載請註明出處。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"已切換為繁體中文","cht_to_chs":"已切換為簡體中文","day_to_night":"已切換為深色模式","night_to_day":"已切換為淺色模式","bgLight":"#222297","bgDark":"#222297","position":"top-center"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '載入更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '資料結構 進階實作（C++）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style type="text/css">#toggle-sidebar {bottom: 80px}</style><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">載入中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (true) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.webp" onerror="this.onerror=null;this.src='/img/loading.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">標籤</div><div class="length-num">162</div></a><a href="/categories/"><div class="headline">分類</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-file-lines"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 連結</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa-solid fa-headphones"></i><span> 音樂</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/data_structure_advan.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/4yublog.png" alt="Logo"><span class="site-name">4yu Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">資料結構 進階實作（C++）</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首頁</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-file-lines"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 標籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分類</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 連結</span></a></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fa-solid fa-headphones"></i><span> 音樂</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 關於</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">資料結構 進階實作（C++）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2024-02-29T16:00:00.000Z" title="發表於 2024-03-01 00:00:00">2024-03-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2026-02-11T21:19:49.636Z" title="更新於 2026-02-12 05:19:49">2026-02-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AD%86%E8%A8%98/">筆記</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AD%86%E8%A8%98/DSA/">DSA</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">總字數:</span><span class="word-count">1.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">閱讀時間:</span><span>6分鐘</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">瀏覽量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">評論數:</span><a href="/post/Data-Structures/#post-comment"><span class="gitalk-comment-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="本篇文章仍在撰寫中-請稍等內容完整後再閱讀…">本篇文章仍在撰寫中 請稍等內容完整後再閱讀…<a class="header-anchor" href="#本篇文章仍在撰寫中-請稍等內容完整後再閱讀…"> 🔗</a></h1>
<blockquote>
<p>本篇文章連結：<a href="https://4yu.dev/post/Data-Structures/">https://4yu.dev/post/Data-Structures/</a></p>
</blockquote>
<h1 id="intro">Intro<a class="header-anchor" href="#intro"> 🔗</a></h1>
<p>此篇文章使用 C++ 來實作各種從基礎到進階的資料結構<br>
可先閱讀這篇關於 C++ 內建基礎資料結構的 <a class="btn-beautify blue" href="/post/STL/" title="C++ STL 大全"><i class="fa-solid fa-hand-point-right"></i><span>C++ STL 大全</span></a> 後再回來繼續<br>
STL 中的基礎資料結構只需學會如何應用即可，而此篇的資料結構則是要自行實作<br>
內容一樣很多，若有編寫錯誤之處請使用右側聊天室回報給我，將盡快修改</p>
<hr>
<h1 id="實作資料結構">實作資料結構<a class="header-anchor" href="#實作資料結構"> 🔗</a></h1>
<p>本篇包含以下資料結構的實作</p>
<ul>
<li>前綴和 &amp; 差分數列</li>
<li>樹狀數組 BIT</li>
<li>稀疏表 Sparse Table</li>
<li>線段樹 Segment Tree</li>
<li>鏈結串列 Linked-list</li>
<li>並查集 DSU</li>
<li>二元搜尋樹 BST</li>
<li>樹堆 Treap</li>
<li>伸展樹 Splay Tree</li>
<li>字典樹 Trie</li>
<li>rope</li>
<li>pbds</li>
</ul>
<hr>
<h2 id="前綴和-差分數列">前綴和 &amp; 差分數列<a class="header-anchor" href="#前綴和-差分數列"> 🔗</a></h2>
<p>本篇開頭以此做為基礎，與其稱呼它們為資料結構，我更傾向將它們視為一種能有效的降低時間複雜度的重要預處理技巧</p>
<p>前綴和（Prefix Sum）可以簡單理解為 <code>數列由前往後累加的值</code></p>
<p><img src="https://hackmd.io/_uploads/Hyl0qg__C.png" alt="image"></p>
<h3 id="建出前綴和數列">建出前綴和數列<a class="header-anchor" href="#建出前綴和數列"> 🔗</a></h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(n)</span>, <span class="title">p</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">    p[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; v[i];</span><br><span class="line">        sum[i<span class="number">+1</span>] = v[i] + p[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i:p) cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：前綴和數列會比原數列多了一項，記得初始化第 0 項為 0</p>
</blockquote>
<h4 id="input">Input<a class="header-anchor" href="#input"> 🔗</a></h4>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">5</span><br><span class="line">1 2 3 4 5</span><br></pre></td></tr></table></figure>
<h4 id="output">Output<a class="header-anchor" href="#output"> 🔗</a></h4>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 3 6 10 15 </span><br></pre></td></tr></table></figure>
<h3 id="快速查詢區間和">快速查詢區間和<a class="header-anchor" href="#快速查詢區間和"> 🔗</a></h3>
<p>要查詢數列區間 <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>l</mi><mo separator="true">,</mo><mi>r</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[l,r]</annotation></semantics></math></span> 的和，原始方法是用迴圈慢慢加</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=l;i&lt;=r;++i) sum += p[i];</span><br></pre></td></tr></table></figure>
<p>有了前綴和後，每次查詢使用一次減法 <code>第 r+1 項 - 第 l 項</code> 即可快速取得區間和，直接將時間複雜度從 <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span> 降到 <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span></p>
<p><img src="https://hackmd.io/_uploads/rJzZoxO_C.png" alt="image"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> q,l,r; cin &gt;&gt; q;</span><br><span class="line"><span class="keyword">while</span>(q--)</span><br><span class="line">&#123;</span><br><span class="line">    cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">    cout &lt;&lt; p[r<span class="number">+1</span>] - p[l] &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="內建函數">內建函數<a class="header-anchor" href="#內建函數"> 🔗</a></h3>
<p>std 內建了可以建立前綴和的函數 <code>partial_sum(原數列起點, 原數列終點, 新數列起點)</code>，使用方法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(n)</span>, <span class="title">p</span><span class="params">(n<span class="number">+1</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;i:v) cin &gt;&gt; i;</span><br><span class="line">    <span class="built_in">partial_sum</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), p.<span class="built_in">begin</span>()<span class="number">+1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i:p) cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>前綴和能快速取得區間和，而快速取得區間的最大/最小值則會用到本篇內容之一的 <code>稀疏表 Sparse Table</code></p>
</blockquote>
<blockquote>
<p>補充：後綴和（Suffix Sum）<br>
會前綴和就知道後綴和就是由後往前累加的值，可以自己試著建看看</p>
</blockquote>
<h3 id="二維前綴和">二維前綴和<a class="header-anchor" href="#二維前綴和"> 🔗</a></h3>
<p>二維前綴和是前綴和概念在二維空間的擴展，可快速查詢二維平面上任意子矩形的數值總和</p>
<p><img src="https://hackmd.io/_uploads/HyfiOMd_R.png" alt="image"></p>
<p>首先要先了解排容原理</p>
<p><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>∪</mo><mi>B</mi><mo>=</mo><mi>A</mi><mo>+</mo><mi>B</mi><mo>−</mo><mi>A</mi><mo>∩</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">A \cup B = A + B - A \cap B</annotation></semantics></math></span></p>
<p><img src="https://hackmd.io/_uploads/B1GD0zOOA.png" alt="image"></p>
<p>而二維前綴和也運用了這個原理</p>
<p><img src="https://hackmd.io/_uploads/BkG-mX__A.png" alt="image"></p>
<h4 id="建出二維前綴和">建出二維前綴和<a class="header-anchor" href="#建出二維前綴和"> 🔗</a></h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RPT(i,n) for(int i=1;i&lt;=n;++i)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100</span>;</span><br><span class="line"><span class="type">int</span> tb[N][N], pre[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> r,c; cin &gt;&gt; r &gt;&gt; c;</span><br><span class="line">    <span class="built_in">RPT</span>(i,r) <span class="built_in">RPT</span>(j,c)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; tb[i][j];</span><br><span class="line">        pre[i][j] = pre[i<span class="number">-1</span>][j] + pre[i][j<span class="number">-1</span>] </span><br><span class="line">                  - pre[i<span class="number">-1</span>][j<span class="number">-1</span>] + tb[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">RPT</span>(i,r) <span class="built_in">RPT</span>(j,c) cout &lt;&lt; pre[i][j] &lt;&lt; <span class="string">&quot; \n&quot;</span>[j == c];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="input-2">Input<a class="header-anchor" href="#input-2"> 🔗</a></h4>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2 3</span><br><span class="line">4 5 6</span><br><span class="line">7 8 9</span><br></pre></td></tr></table></figure>
<h4 id="output-2">Output<a class="header-anchor" href="#output-2"> 🔗</a></h4>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 3 6</span><br><span class="line">5 12 21</span><br><span class="line">12 27 45</span><br></pre></td></tr></table></figure>
<h4 id="查詢子矩形總和">查詢子矩形總和<a class="header-anchor" href="#查詢子矩形總和"> 🔗</a></h4>
<p>建完二維前綴和後每個子矩形皆會在右下角的點形成總和<br>
查詢任意子矩形都可以用排容原理計算出來<br>
不用使用雙重迴圈一個一個加起來<br>
以下示範計算 (x1,y1) 到 (x2,y2) 的子矩形總和</p>
<p><img src="https://hackmd.io/_uploads/rySi57u_C.png" alt="image"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> q; cin &gt;&gt; q;</span><br><span class="line"><span class="keyword">while</span>(q--)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x1,x2,y1,y2;</span><br><span class="line">    cin &gt;&gt; x1 &gt;&gt; y1 &gt;&gt; x2 &gt;&gt; y2;</span><br><span class="line">    x1--; y1--;</span><br><span class="line">    <span class="type">int</span> sum = pre[x2][y2] - pre[x1][y2] </span><br><span class="line">            - pre[x2][y1] + pre[x1][y1];</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="差分數列">差分數列<a class="header-anchor" href="#差分數列"> 🔗</a></h3>
<p>與前綴和相反的概念，差分數列為原數列相鄰元素的差值</p>
<h4 id="建出差分數列">建出差分數列<a class="header-anchor" href="#建出差分數列"> 🔗</a></h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n; cin &gt;&gt; n;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">v</span><span class="params">(n)</span>, <span class="title">d</span><span class="params">(n)</span></span>;</span><br><span class="line">    cin &gt;&gt; v[<span class="number">0</span>]; d[<span class="number">0</span>] = v[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; v[i];</span><br><span class="line">        d[i] = v[i] - v[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i:d) cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我們要解決以下問題：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在區間 [l,r] 加上 x，經過多次不同的操作後，求最後的數列</span><br></pre></td></tr></table></figure>
<p>有了差分數列我們就不用每次操作都用迴圈在原數列上從 l 到 r 逐個加上 x<br>
只需在差分數列上做以下兩步操作：</p>
<ol>
<li>第 l 項 + x（相當於將原數列第 l 項開始以後的數都 + x）</li>
<li>第 r+1 項 - x（相當於將原數列第 r+1 項開始以後的數停止 + x）</li>
</ol>
<p>所以不管區間 <code>[l,r]</code> 多大，都只用兩次加減法操作就能達成在區間 <code>[l,r]</code> 加上 x<br>
所有操作結束後對差分數列做一次前綴和即可得到最後的數列結果，也成功降低了時間複雜度</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> q,l,r,x; cin &gt;&gt; q;</span><br><span class="line"><span class="keyword">while</span>(q--)</span><br><span class="line">&#123;</span><br><span class="line">    cin &gt;&gt; l &gt;&gt; r &gt;&gt; x;</span><br><span class="line">    d[l] += x;</span><br><span class="line">    d[r<span class="number">+1</span>] -= x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)</span><br><span class="line">&#123;</span><br><span class="line">    sum += d[i];</span><br><span class="line">    cout &lt;&lt; sum &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：此方法只適用於不需要中途詢問的情況，前綴和 &amp; 差分如果要帶修改則會用到本篇內容之一的 <code>BIT 樹狀數組</code></p>
</blockquote>
<blockquote>
<p>補充：二維差分數列<br>
可以自行試著建看看，能有效地處理二維矩形區域更新的操作</p>
</blockquote>
<h3 id="小結">小結<a class="header-anchor" href="#小結"> 🔗</a></h3>
<p>這兩種資料結構在處理區間操作時非常有用，特別是在需要頻繁進行區間求和或區間更新的問題中</p>
<p>差分和前綴和互為逆運算<br>
<code>對差分數列做前綴和</code> 或 <code>對前綴和數列作差分</code> 都會獲得 <code>原陣列</code></p>
<hr>
<h1 id="本篇文章作者比較懶，仍持續在撰寫中，請稍等內容完整後再閱讀…">本篇文章作者比較懶，仍持續在撰寫中，請稍等內容完整後再閱讀…<a class="header-anchor" href="#本篇文章作者比較懶，仍持續在撰寫中，請稍等內容完整後再閱讀…"> 🔗</a></h1>
<hr>
<h2 id="樹狀數組-bit">樹狀數組 BIT<a class="header-anchor" href="#樹狀數組-bit"> 🔗</a></h2>
<!-- 樹狀樹組，英文叫做 Fenwick Tree 或 Binary Indexed Tree，又簡稱 BIT，由 Fenwick 在
1994 年提出，用來解決「動態前綴和」問題 -->
<hr>
<h2 id="稀疏表-sparse-table">稀疏表 Sparse Table<a class="header-anchor" href="#稀疏表-sparse-table"> 🔗</a></h2>
<hr>
<h2 id="線段樹-segment-tree">線段樹 Segment Tree<a class="header-anchor" href="#線段樹-segment-tree"> 🔗</a></h2>
<hr>
<h2 id="鏈結串列-linked-list">鏈結串列 Linked-list<a class="header-anchor" href="#鏈結串列-linked-list"> 🔗</a></h2>
<hr>
<h2 id="並查集-dsu">並查集 DSU<a class="header-anchor" href="#並查集-dsu"> 🔗</a></h2>
<!-- Disjoint Set Union-find -->
<hr>
<h2 id="二元搜尋樹-bst">二元搜尋樹 BST<a class="header-anchor" href="#二元搜尋樹-bst"> 🔗</a></h2>
<hr>
<h2 id="樹堆-treap">樹堆 Treap<a class="header-anchor" href="#樹堆-treap"> 🔗</a></h2>
<hr>
<h2 id="伸展樹-splay-tree">伸展樹 Splay Tree<a class="header-anchor" href="#伸展樹-splay-tree"> 🔗</a></h2>
<hr>
<h2 id="動態樹-link-cut-tree">動態樹 Link-Cut Tree<a class="header-anchor" href="#動態樹-link-cut-tree"> 🔗</a></h2>
<hr>
<h2 id="字典樹-trie">字典樹 Trie<a class="header-anchor" href="#字典樹-trie"> 🔗</a></h2>
<hr>
<h2 id="rope">rope<a class="header-anchor" href="#rope"> 🔗</a></h2>
<!-- rope 是一個很強大的字串處理資料結構，聽說是為了與字串 string（英譯：細繩）做對比才叫做 rope（英譯：粗繩）的，其底層是一棵持久化平衡樹，因此在做合併或在中間插入的期望時間複雜度是 $O(\log n)$ -->
<hr>
<h2 id="pbds">pbds<a class="header-anchor" href="#pbds"> 🔗</a></h2>
<hr>
<a class="btn-beautify blue block center larger" href="/post/Sitemap/" title="回到導覽頁面"><i class="far fa-hand-point-right"></i><span>回到導覽頁面</span></a>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://4yu.dev/">ShiYu Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章連結: </span><span class="post-copyright-info"><a href="https://4yu.dev/post/Data-Structures/">https://4yu.dev/post/Data-Structures/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版權聲明: </span><span class="post-copyright-info">本部落格所有文章除特別聲明外，均採用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 授權協議。轉載請註明來源 <a href="https://4yu.dev" target="_blank">4yu Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/C/">C++</a><a class="post-meta__tags" href="/tags/%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B-Data-Structures/">資料結構 Data Structures</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%B6%B4%E5%92%8C-%E5%B7%AE%E5%88%86%E6%95%B8%E5%88%97/">前綴和 &amp; 差分數列</a><a class="post-meta__tags" href="/tags/%E6%A8%B9%E7%8B%80%E6%95%B8%E7%B5%84-BIT/">樹狀數組 BIT</a><a class="post-meta__tags" href="/tags/%E7%A8%80%E7%96%8F%E8%A1%A8-Sparse-Table/">稀疏表 Sparse Table</a><a class="post-meta__tags" href="/tags/%E7%B7%9A%E6%AE%B5%E6%A8%B9-Segment-Tree/">線段樹 Segment Tree</a><a class="post-meta__tags" href="/tags/%E9%8F%88%E7%B5%90%E4%B8%B2%E5%88%97-Linked-list/">鏈結串列 Linked-list</a><a class="post-meta__tags" href="/tags/%E4%B8%A6%E6%9F%A5%E9%9B%86-DSU/">並查集 DSU</a><a class="post-meta__tags" href="/tags/%E4%BA%8C%E5%85%83%E6%90%9C%E5%B0%8B%E6%A8%B9-BST/">二元搜尋樹 BST</a><a class="post-meta__tags" href="/tags/%E6%A8%B9%E5%A0%86-Treap/">樹堆 Treap</a><a class="post-meta__tags" href="/tags/%E4%BC%B8%E5%B1%95%E6%A8%B9-Splay-Tree/">伸展樹 Splay Tree</a><a class="post-meta__tags" href="/tags/%E5%8B%95%E6%85%8B%E6%A8%B9-Link-Cut-Tree/">動態樹 Link-Cut Tree</a><a class="post-meta__tags" href="/tags/%E5%AD%97%E5%85%B8%E6%A8%B9-Trie/">字典樹 Trie</a><a class="post-meta__tags" href="/tags/rope/">rope</a><a class="post-meta__tags" href="/tags/pbds/">pbds</a></div><div class="post-share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_copy_link"></a><a class="a2a_button_email"></a><a class="a2a_button_facebook"></a><a class="a2a_button_facebook_messenger"></a><a class="a2a_button_line"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_threads"></a><a class="a2a_button_x"></a><a class="a2a_button_google_classroom"></a><a class="a2a_button_blogger"></a><a class="a2a_button_google_gmail"></a><a class="a2a_dd" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.addtoany.com/share"></a></div></div><script async="async" src="https://static.addtoany.com/menu/page.js"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/post/SCIST-Camp-2024/" title="南九校資訊社 x 成大資工 x SCIST 2024 聯合寒訓 - 資得其樂 籌辦心得"><img class="cover" src="/img/wintercamp2024.webp" onerror="onerror=null;src='/img/loading.gif'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">南九校資訊社 x 成大資工 x SCIST 2024 聯合寒訓 - 資得其樂 籌辦心得</div></div><div class="info-2"><div class="info-item-1">寒訓詳細資訊 🔗  引言 🔗 在 2023/11/25 這次的寒訓總召 茶碗蒸 私訊我問說要不要一起辦寒訓，但其實我們南附資研在 2023/11/13 幹部線上開會時就有討論到說寒假要辦營隊，本來沒想說要辦那麼大規模的寒訓，那時的規劃主要是開放給校內的所有學生和老師，大概會舉辦講座提供給校內對資訊領域有興趣的人，且主題訂為資訊領域的多元課程。 後來思考過後決定接下本次寒訓副召，一開始的召群有南女的總召 茶碗蒸、一中的副召 KCC 還有我，加上 Fishhh、Eason 和 Curious 這三位 SCIST S4 的總召們協助，讓我們日後籌備更順利。  籌備階段 🔗 我們是先開了線上會議，確認好活動目的與受眾，排好 Deadline 後才開始籌備，一開始是要先招募工作人員，因為有茶碗蒸這個 SCIST 文書在，所以各種表單很快就做好了，而且他也有之前辦茶會迎新的經驗，所以初期還挺順利的，也在一開始就把各校的邀請訊息發出去了，最後是找到了 9 間學校聯合主辦，而 SCIST 則是掛協辦，提供我們講師助教等課程上的資源，我們也開始著手撰寫計劃書、排時間表、預估經費、詢問場地租借…等。在計劃書撰寫上感謝小白幫了很大的忙，而其他的事情也很幸運有上一屆寒訓的 PJ、Koying…等人的努力，有留下文檔提供我們很多資訊可作參考，讓我們在初期不容易迷失方向，對我們幫助很大。 在短短的一週內，就收到了個主辦校報名的工作人員 35 人左右，其中我從南附資研中就拉了 10 幾個人來當行政，加上 SCIST 的講師及助教，最後行政組達到了 50 人左右。  我們接著開放學員報名，一開始報名狀況其實不是很好，我們很怕無法收到預估的學員人數，所以加強了各校的宣傳，我也以擔任小編的經驗到各大社團和營隊網站上刊登廣告，後來發現報名期間只有第一週和最後一週報名人數才會增加的現象… 在這要感謝成功大學資工系的 Colten 幫忙處理成大場地以及接線讓成大資工系與本次寒訓合作，讓推廣曝光提升了很多，也提供了我們成大超級棒的階梯教室和電腦教室場地給寒訓使用，也要特別感謝副召 KCC 不斷地與南一中接洽，才能有超大的群英堂提供我們舉辦晚會活動。  過了學員報名期限，很開心的我們收到了超過 100 多位學生的報名，接下來就是繁瑣篩選學員環節，繁瑣是因為要閱讀大量的試算表內容，根據報名者的意願、動...</div></div></div></a><a class="pagination-related" href="/post/NFIRC/" title="NFIRC 南附資研社 - 從零開始的社團創辦與經營之路"><img class="cover" src="/img/NFIRC%20%E6%A9%AB.webp" onerror="onerror=null;src='/img/loading.gif'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">NFIRC 南附資研社 - 從零開始的社團創辦與經營之路</div></div><div class="info-2"><div class="info-item-1">創社計畫 🔗 創社歷程、成果、心得與反思 🔗 撰寫中 … 🔗 第一屆年報 🔗  回到導覽頁面  </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相關推薦</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/post/STL/" title="C++ STL 大全"><img class="cover" src="/img/data_structure_basic.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-31</div><div class="info-item-2">C++ STL 大全</div></div><div class="info-2"><div class="info-item-1"> 本篇文章連結：https://4yu.dev/post/STL/ 公開發布日期：2023/12/31  Intro 🔗 學完 C++ 基礎語法之後，接著就該進入資料結構的世界了！ 本篇筆記要介紹的是 C++ STL，彙整了許多基礎資料結構的概念與用法 文章內容較多，大部分內容為自行收集資料後經過整理而成 若有任何錯誤或需要補充的地方都歡迎使用右側聊天室傳送訊息給我 我將會儘速修改，謝謝 先備知識 🔗 標準模板庫（Standard Template Library），簡稱 STL，為 C++ 內建的函式庫 為了應對各種資料型態，因此 STL 內部採用 模板 template 來實作，分為六大部分：  容器（Containers） 演算法（Algorithm） 迭代器（Iterator） 適配器（Adaptor） 仿函數（Function object） 空間配置器（allocator）   本篇文章內容著重於前四大部分  符號解釋 🔗 對於本篇文章中各種符號的解釋  C：某種容器（container） T：某種資料型態（type） S：長度（size） i：索引（index） K：鍵（key） val：值（value） it：迭代器（iterator）  迭代器（iterator） 🔗 C++ STL 為每個容器提供一個成員型別：迭代器 Iterator，我們可以用 指標 pointer 的概念來理解迭代器 迭代器透過運算子重載，為不同資料結構定義「如何走訪下一步」，模擬出指標的走訪功能，但能在移動前進行安全判斷或執行額外功能，解決了指標走訪時容易發生越界或亂指的問題 假設現在有個迭代器 it，如果要存取 it 所指向的內容，就在前面加上星號 *it，與指標相同 迭代器有以下三種類型：  隨機存取迭代器：能夠作整數的加減法，往 後移 x 項、往 前移 x 項 皆可，也能 遞增 (++) 和 遞減 (−−)，可以把指標當作這種迭代器 雙向迭代器：只能做 遞增 (++) 和 遞減 (−−) 的運算，也就是 後一項 和 前一項 單向迭代器：只能做 遞增 (++) 的運算，也就是 後一項  利用迭代器可遍歷容器中的元素，又分為 iterator 和 reverse_iterator（反向迭代器）  iterator  .begin()：指向容器的起始元素 .e...</div></div></div></a><a class="pagination-related" href="/post/Sort-Algorithm/" title="排序演算法 Sort Algorithm"><img class="cover" src="/img/Sort_cover.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-25</div><div class="info-item-2">排序演算法 Sort Algorithm</div></div><div class="info-2"><div class="info-item-1"> 本篇文章連結：https://4yu.dev/post/Sort-Algorithm/ 公開發布日期：2023/02/25   本文架構 🔗 線性排序演算法種類 🔗  氣泡排序 Bubble Sort 選擇排序 Selection Sort 插入排序 Insertion Sort 快速排序 Quick Sort 合併排序 Merge Sort 堆排序 Heap Sort 希爾排序 Shell Sort 計數排序 Counting Sort 桶排序 Bucket Sort 基數排序 Radix Sort  每個排序演算法的內容 🔗  排序介紹 動畫演示 實作步驟 C++ 程式碼 注意事項 時間複雜度 總結  測試模板 🔗 本文介紹的 10 種排序演算法都會附上寫好的函式，這裡提供可 EOF 輸入的測試模版，請在區塊中加上各種排序演算法函式，若沒有指定呼叫方法則直接呼叫函式名稱即可運作 123456789101112131415161718192021222324252627#include &lt;bits/stdc++.h&gt;using namespace std;vector&lt;int&gt; v;// 可以將底下的某個排序演算法函式複製起來放進來這個區塊// ----------------------------------------------// ----------------------------------------------int main(void)&#123;    int n;    while (cin &gt;&gt; n) v.emplace_back(n);    // 這行放入某個排序演算法函式名稱用來呼叫 例如：BubbleSort();    // ------------------------------------------    // ------------------------------------------        for (auto &amp;i : v) cout &lt;&lt; v[i] &lt;&lt; &quot; &quot;;    return 0;&#125;  排序演算法的詳細介紹 🔗 氣泡排序 Bubble Sort 🔗 氣泡排序是一種簡單的...</div></div></div></a><a class="pagination-related" href="/post/NHSPC/" title="資訊學科能力競賽 參賽心得"><img class="cover" src="/img/NHSPC.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-03</div><div class="info-item-2">資訊學科能力競賽 參賽心得</div></div><div class="info-2"><div class="info-item-1">競賽資訊 🔗  名稱：112 學年度學科能力競賽 複賽 資訊科 賽區：國教署負責區第四區（台南） 時間：2023/11/2 地點：台南女中 比賽人數：50 人（資訊科） 獲獎人數：1 ~ 5 名進全國賽 再大約取前三分之一的人獲得佳作 當天詳細時程：   前言 🔗 這是我第一次比資訊學科能力競賽 高一時不知道在幹嘛 那時不太關注資訊比賽 南大附中好像也沒什麼人比過資訊能競 所以我跟 @YuDong 不用校內初選就直接進複賽了 南區去年只有選 3 名進全國賽 今年因為去年的南一中有人全國賽一等二等獎 所以新增了 2 個 總共有 5 個名額 賽前猜測沒意外應該都是南一中的 我們第一次比賽就遇到主辦方各種出錯 這個留到文章最後再說 此篇文章就是寫我參加此競賽的過程、解題程式碼、心得、和檢討 純粹記錄自己這個時候有多菜 讓自己幾年後可以回顧一下 如果你也是資訊選手或打競程的 那這篇其實可以滑掉不用看了 因為對你來說可能是一篇廢文 沒什麼參考價值 上午場 🔗 報到抽籤後 發現只有我們學校沒有領隊… 到了我們學校的座位 被排在最後一排 我跟 YuDong 在猜這座位配置是不是依照學校的得獎次數排的哈哈  我在活動中心其實滿緊張的 雖然前幾個禮拜也有參加比賽：CodeWars、金盾獎 但都是抱持著輕鬆愉快的心情比的 可能是因為這場能競對我來說算是滿重要的比賽 整個狀態有點緊繃 到了電腦教室測試時 主辦就開始出現錯誤了 我先跳過這部分最後再說 來寫一下解題過程 p1 🔗 第 1 題明顯滿難的 我看到就先跳過了 p2 🔗  題意  12有各不同的分數種類： 50 25 10 5 1 求總和為 N 分的組合數  Input  12321126  Output  12413  解題想法  1233 層 for 迴圈枚舉每種分數各取幾次因為取完 前幾種分數 剩餘的都可以用 1 分來湊看了數字範圍 確認此做法不會超時後開始寫 Code  AC Code  123456789101112131415161718192021222324252627#include &lt;bits/stdc++.h&gt;using namespace std;#define ShiYu ios::sync_with_stdio(0),cin.tie(0)#define FOR(i,n) for...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 評論</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E7%AF%87%E6%96%87%E7%AB%A0%E4%BB%8D%E5%9C%A8%E6%92%B0%E5%AF%AB%E4%B8%AD-%E8%AB%8B%E7%A8%8D%E7%AD%89%E5%85%A7%E5%AE%B9%E5%AE%8C%E6%95%B4%E5%BE%8C%E5%86%8D%E9%96%B1%E8%AE%80%E2%80%A6"><span class="toc-number">1.</span> <span class="toc-text">本篇文章仍在撰寫中 請稍等內容完整後再閱讀… 🔗</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#intro"><span class="toc-number">2.</span> <span class="toc-text">Intro 🔗</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%A6%E4%BD%9C%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B"><span class="toc-number">3.</span> <span class="toc-text">實作資料結構 🔗</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%B6%B4%E5%92%8C-%E5%B7%AE%E5%88%86%E6%95%B8%E5%88%97"><span class="toc-number">3.1.</span> <span class="toc-text">前綴和 &amp; 差分數列 🔗</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E5%87%BA%E5%89%8D%E7%B6%B4%E5%92%8C%E6%95%B8%E5%88%97"><span class="toc-number">3.1.1.</span> <span class="toc-text">建出前綴和數列 🔗</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#input"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">Input 🔗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#output"><span class="toc-number">3.1.1.2.</span> <span class="toc-text">Output 🔗</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%9F%A5%E8%A9%A2%E5%8D%80%E9%96%93%E5%92%8C"><span class="toc-number">3.1.2.</span> <span class="toc-text">快速查詢區間和 🔗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A7%E5%BB%BA%E5%87%BD%E6%95%B8"><span class="toc-number">3.1.3.</span> <span class="toc-text">內建函數 🔗</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%B6%AD%E5%89%8D%E7%B6%B4%E5%92%8C"><span class="toc-number">3.1.4.</span> <span class="toc-text">二維前綴和 🔗</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E5%87%BA%E4%BA%8C%E7%B6%AD%E5%89%8D%E7%B6%B4%E5%92%8C"><span class="toc-number">3.1.4.1.</span> <span class="toc-text">建出二維前綴和 🔗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#input-2"><span class="toc-number">3.1.4.2.</span> <span class="toc-text">Input 🔗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#output-2"><span class="toc-number">3.1.4.3.</span> <span class="toc-text">Output 🔗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%A9%A2%E5%AD%90%E7%9F%A9%E5%BD%A2%E7%B8%BD%E5%92%8C"><span class="toc-number">3.1.4.4.</span> <span class="toc-text">查詢子矩形總和 🔗</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%AE%E5%88%86%E6%95%B8%E5%88%97"><span class="toc-number">3.1.5.</span> <span class="toc-text">差分數列 🔗</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E5%87%BA%E5%B7%AE%E5%88%86%E6%95%B8%E5%88%97"><span class="toc-number">3.1.5.1.</span> <span class="toc-text">建出差分數列 🔗</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%B5%90"><span class="toc-number">3.1.6.</span> <span class="toc-text">小結 🔗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%AC%E7%AF%87%E6%96%87%E7%AB%A0%E4%BD%9C%E8%80%85%E6%AF%94%E8%BC%83%E6%87%B6%EF%BC%8C%E4%BB%8D%E6%8C%81%E7%BA%8C%E5%9C%A8%E6%92%B0%E5%AF%AB%E4%B8%AD%EF%BC%8C%E8%AB%8B%E7%A8%8D%E7%AD%89%E5%85%A7%E5%AE%B9%E5%AE%8C%E6%95%B4%E5%BE%8C%E5%86%8D%E9%96%B1%E8%AE%80%E2%80%A6"><span class="toc-number">4.</span> <span class="toc-text">本篇文章作者比較懶，仍持續在撰寫中，請稍等內容完整後再閱讀… 🔗</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%B9%E7%8B%80%E6%95%B8%E7%B5%84-bit"><span class="toc-number">4.1.</span> <span class="toc-text">樹狀數組 BIT 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%80%E7%96%8F%E8%A1%A8-sparse-table"><span class="toc-number">4.2.</span> <span class="toc-text">稀疏表 Sparse Table 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B7%9A%E6%AE%B5%E6%A8%B9-segment-tree"><span class="toc-number">4.3.</span> <span class="toc-text">線段樹 Segment Tree 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%8F%88%E7%B5%90%E4%B8%B2%E5%88%97-linked-list"><span class="toc-number">4.4.</span> <span class="toc-text">鏈結串列 Linked-list 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A6%E6%9F%A5%E9%9B%86-dsu"><span class="toc-number">4.5.</span> <span class="toc-text">並查集 DSU 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%85%83%E6%90%9C%E5%B0%8B%E6%A8%B9-bst"><span class="toc-number">4.6.</span> <span class="toc-text">二元搜尋樹 BST 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%B9%E5%A0%86-treap"><span class="toc-number">4.7.</span> <span class="toc-text">樹堆 Treap 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%B8%E5%B1%95%E6%A8%B9-splay-tree"><span class="toc-number">4.8.</span> <span class="toc-text">伸展樹 Splay Tree 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8B%95%E6%85%8B%E6%A8%B9-link-cut-tree"><span class="toc-number">4.9.</span> <span class="toc-text">動態樹 Link-Cut Tree 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E5%85%B8%E6%A8%B9-trie"><span class="toc-number">4.10.</span> <span class="toc-text">字典樹 Trie 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rope"><span class="toc-number">4.11.</span> <span class="toc-text">rope 🔗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pbds"><span class="toc-number">4.12.</span> <span class="toc-text">pbds 🔗</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url(/img/data_structure_advan.webp);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2022 - 2026 By ShiYu Huang</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.1</a></span></div><div class="footer_custom_text">Hope you can learn something from this <a href="https://4yu.dev/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日夜模式切換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="單欄和雙欄切換"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="設定"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天" style="display:none"><i class="fas fa-message"></i></button><a id="to_comment" href="#post-comment" title="前往評論"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到頂端"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const applyThemeDefaultsConfig = theme => {
    if (theme === 'dark-mode') {
      Chart.defaults.color = "rgba(255, 255, 255, 0.8)"
      Chart.defaults.borderColor = "rgba(255, 255, 255, 0.2)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    } else {
      Chart.defaults.color = "rgba(0, 0, 0, 0.8)"
      Chart.defaults.borderColor = "rgba(0, 0, 0, 0.1)"
      Chart.defaults.scale.ticks.backdropColor = "transparent"
    }
  }

  // Recursively traverse the config object and automatically apply theme-specific color schemes
  const applyThemeConfig = (obj, theme) => {
    if (typeof obj !== 'object' || obj === null) return

    Object.keys(obj).forEach(key => {
      const value = obj[key]
      // If the property is an object and has theme-specific options, apply them
      if (typeof value === 'object' && value !== null) {
        if (value[theme]) {
          obj[key] = value[theme] // Apply the value for the current theme
        } else {
          // Recursively process child objects
          applyThemeConfig(value, theme)
        }
      }
    })
  }

  const runChartJS = ele => {
    window.loadChartJS = true

    Array.from(ele).forEach((item, index) => {
      const chartSrc = item.firstElementChild
      const chartID = item.getAttribute('data-chartjs-id') || ('chartjs-' + index) // Use custom ID or default ID
      const width = item.getAttribute('data-width')
      const existingCanvas = document.getElementById(chartID)

      // If a canvas already exists, remove it to avoid rendering duplicates
      if (existingCanvas) {
          existingCanvas.parentNode.remove()
      }

      const chartDefinition = chartSrc.textContent
      const canvas = document.createElement('canvas')
      canvas.id = chartID

      const div = document.createElement('div')
      div.className = 'chartjs-wrap'

      if (width) {
        div.style.width = width
      }

      div.appendChild(canvas)
      chartSrc.insertAdjacentElement('afterend', div)

      const ctx = document.getElementById(chartID).getContext('2d')

      const config = JSON.parse(chartDefinition)

      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark-mode' : 'light-mode'

      // Set default styles (initial setup)
      applyThemeDefaultsConfig(theme)

      // Automatically traverse the config and apply dual-mode color schemes
      applyThemeConfig(config, theme)

      new Chart(ctx, config)
    })
  }

  const loadChartJS = () => {
    const chartJSEle = document.querySelectorAll('#article-container .chartjs-container')
    if (chartJSEle.length === 0) return

    window.loadChartJS ? runChartJS(chartJSEle) : btf.getScript('https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js').then(() => runChartJS(chartJSEle))
  }

  // Listen for theme change events
  btf.addGlobalFn('themeChange', loadChartJS, 'chartjs')
  btf.addGlobalFn('encrypt', loadChartJS, 'chartjs')

  window.pjax ? loadChartJS() : document.addEventListener('DOMContentLoaded', loadChartJS)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  const initGitalk = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyGitalk = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const gitalk = new Gitalk({
      clientID: '00b71ed70ef8fddbb291',
      clientSecret: 'c65b4a8a79a864a01f9ebf89991c6dab6ab50102',
      repo: 'ShiYu0318.github.io',
      owner: 'ShiYu0318',
      admin: ['ShiYu0318'],
      updateCountCallback: commentCount,
      ...option,
      id: isShuoshuo ? path : (option && option.id) || '49b9bd95c9c2536114e795f550e02026'
    })

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async(el, path) => {
    if (typeof Gitalk === 'function') initGitalk(el, path)
    else {
      await btf.getCSS('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css')
      await btf.getScript('https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js')
      initGitalk(el, path)
    }
  }

  if (isShuoshuo) {
    'Gitalk' === 'Gitalk'
      ? window.shuoshuoComment = { loadComment: loadGitalk }
      : window.loadOtherComment = loadGitalk
    return
  }

  if ('Gitalk' === 'Gitalk' || !false) {
    if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script>window.newestComments = {
  changeContent: content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[圖片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[連結]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[程式碼]') // replace code
    content = content.replace(/<code>.*?<\/code>/gi, '[程式碼]') // replace code
    content = content.replace(/<[^>]+>/g, "") // remove html tag

    if (content.length > 150) {
      content = content.substring(0, 150) + '...'
    }
    return content
  },

  generateHtml: (array, ele) => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class="aside-list-item">'

        if (true && array[i].avatar) {
          const imgAttr = 'src'
          const lazyloadNative = ''
          result += `<a href="${array[i].url}" class="thumbnail"><img ${imgAttr}="${array[i].avatar}" alt="${array[i].nick}" ${lazyloadNative}></a>`
        }

        result += `<div class="content">
        <a class="comment" href="${array[i].url}" title="${array[i].content}">${array[i].content}</a>
        <div class="name"><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '尚無評論'
    }

    ele.innerHTML = result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh(ele)
  },

  newestCommentInit: (name, getComment) => {
    const $dom = document.querySelector('#card-newest-comments .aside-list')
    if ($dom) {
      const data = btf.saveToLocal.get(name)
      if (data) {
        newestComments.generateHtml(JSON.parse(data), $dom)
      } else {
        getComment($dom)
      }
    }
  },

  run: (name, getComment) => {
    newestComments.newestCommentInit(name, getComment)
    btf.addGlobalFn('pjaxComplete', () => newestComments.newestCommentInit(name, getComment), name)
  }
}</script><script>window.addEventListener('load', () => {
  const keyName = 'github-newest-comments'
  const { changeContent, generateHtml, run } = window.newestComments

  const findTrueUrl = (array, ele) => {
    Promise.all(array.map(item =>
      fetch(item.url).then(resp => resp.json()).then(data => {
        let urlArray = data.body ? data.body.match(/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?/ig) : []
        if (!Array.isArray(urlArray) || urlArray.length === 0) {
          urlArray = [`${data.html_url}`]
        }
        if (data.user.login === 'utterances-bot') {
          return urlArray.pop()
        } else {
          return urlArray.shift()
        }
      })
    )).then(res => {
        array = array.map((i,index)=> {
          return {
            ...i,
            url: res[index]
          }
        })

        btf.saveToLocal.set(keyName, JSON.stringify(array), 30/(60*24))
        generateHtml(array, ele)
    });
  }

  const getComment = ele => {
    fetch('https://api.github.com/repos/ShiYu0318/ShiYu0318.github.io/issues/comments?sort=updated&direction=desc&per_page=10&page=1',{
      "headers": {
        Accept: 'application/vnd.github.v3.html+json'
      }
    })
      .then(response => response.json())
      .then(data => {
        const githubArray = data.map(item => {
          return {
            'avatar': item.user.avatar_url,
            'content': changeContent(item.body_html || item.body),
            'nick': item.user.login,
            'url': item.issue_url,
            'date': item.updated_at
          }
        })
        findTrueUrl(githubArray, ele)
      }).catch(e => {
        console.error(e)
        ele.textContent= "無法獲取評論，請確認相關配置是否正確"
      })
  }
  run(keyName, getComment)
})</script><div class="aplayer no-destroy" data-id="7218222301" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="true" data-theme="#2828FF" data-loop="none" data-order="random" data-mini="true" data-mutex="true" data-volume="1.0"> </div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script>(() => {
  window.ChatraID = 'NxXNSWTTNGbjfwQGi'
  window.Chatra = window.Chatra || function() {
    (window.Chatra.q = window.Chatra.q || []).push(arguments)
  }

  btf.getScript('https://call.chatra.io/chatra.js').then(() => {
    const isChatBtn = true
    const isChatHideShow = false

    if (isChatBtn) {
      const close = () => {
        Chatra('minimizeWidget')
        Chatra('hide')
      }

      const open = () => {
        Chatra('openChat', true)
        Chatra('show')
      }

      window.ChatraSetup = { startHidden: true }
    
      window.chatBtnFn = () => document.getElementById('chatra').classList.contains('chatra--expanded') ? close() : open()

      document.getElementById('chat-btn').style.display = 'block'
    } else if (isChatHideShow) {
      window.chatBtn = {
        hide: () => Chatra('hide'),
        show: () => Chatra('show')
      }
    }
  })
})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: true,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      true
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>